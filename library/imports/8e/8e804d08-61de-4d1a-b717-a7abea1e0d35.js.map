{"version":3,"sources":["assets/scripts/Plugins/Camera/CameraController2D.js"],"names":["StickModes","cc","Enum","None","Top","Bottom","Right","Left","CaptureBoxHelper","Class","name","properties","stickMode","type","tooltip","defaultBox","Node","get","_isTransition","_transitionBox","_defaultBox","set","box","serializable","_transitTween","pg","Tween","_transitValue","_transitionResize","ResizeComponent","transitToBox","newBox","duration","easing","cancelTransition","tweenManager","add","_setTransitBox","defaultBoxResize","getComponent","newBoxResize","initialPos","position","clone","onUpdate","x","y","width","height","onComplete","stop","addComponent","setParent","parent","Component","focus","v2","isUsingCameraBoxes","boxHelper","visible","fitSpace","deltaShake","Vec2","ZERO","shakeFrequency","_camera","_boxes","_currentShakeOffset","_isShaking","_shakingTime","_staticCameraPos","editor","menu","onLoad","node","Camera","_handleSubscription","onEnable","update","dt","_updatePosition","_updateZoomRatio","xOffset","Math","sin","PI","yOffset","isOn","func","systemEvent","GameEvent","CAMERA_TRANSIT_BOX","onCameraTransitBox","CAMERA_BOX_ADD","onCameraBoxAdd","CAMERA_BOX_SWITCH","onCameraBoxSwitch","CAMERA_START_SHAKE","onCameraStartShake","CAMERA_STOP_SHAKE","onCameraStopShake","zoomRatio","tw","th","gw","settings","GAME_WIDTH","gh","GAME_HEIGHT","zX","zY","max","min","_setZoomRatio","targetWorldPosition","convertToWorldSpaceAR","offset","anchorX","anchorY","cameraWorldPosition","_checkStickPosition","cameraLocalPosition","convertToNodeSpaceAR","setPosition","cameraWorld","viewSize","view","getVisibleSize"],"mappings":"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","sourceRoot":"/","sourcesContent":["//#region import\n\nimport GameEvent from 'GameEvent';\n\n//#endregion\n\nconst StickModes = cc.Enum({\n    None: 0,\n    Top: 1,\n    Bottom: 2,\n    Right: 3,\n    Left: 4,\n});\n\nconst CaptureBoxHelper = cc.Class({\n    name: 'CaptureBoxHelper',\n    properties: {\n        //#region editors fields and properties\n\n        stickMode: {\n            default: StickModes.Bottom,\n            type: StickModes,\n            tooltip: 'к какой стороне экрана прилипает изображение',\n        },\n        defaultBox: {\n            type: cc.Node,\n            get() {\n                return this._isTransition && this._transitionBox ? this._transitionBox : this._defaultBox;\n            },\n            set(box) {\n                if (box instanceof cc.Node) {\n                    this._defaultBox = box;\n                }\n            },\n            tooltip: 'начальная коробка, на которую смотрит камера',\n        },\n\n        //#endregion\n\n        //#region private field and properties\n\n        _defaultBox: { default: null, type: cc.Node },\n\n        _isTransition: { default: false, serializable: false },\n        _transitTween: { default: null, type: pg.Tween, serializable: false },\n        _transitValue: { default: 0, serializable: false },\n\n        _transitionBox: { default: null, type: cc.Node, serializable: false },\n        _transitionResize: { default: null, type: pg.ResizeComponent, serializable: false },\n\n        //#endregion\n    },\n\n    transitToBox(newBox, duration, easing) {\n        this._isTransition && this.cancelTransition();\n        this._transitValue = 0;\n\n        this._transitTween = pg.tweenManager.add(this, { _transitValue: 1 }, duration, easing);\n        this._setTransitBox(newBox);\n\n        const defaultBoxResize = this.defaultBox.getComponent(pg.ResizeComponent);\n        const newBoxResize = newBox.getComponent(pg.ResizeComponent);\n\n        if (defaultBoxResize && newBoxResize) {\n            this._transitionResize.set(defaultBoxResize);\n\n            const initialPos = this.defaultBox.position.clone();\n\n            this._transitTween.onUpdate = () => {\n                // FIXME: lerp resize with absolute position\n                //defaultBoxResize.lerp(newBoxResize, this._transitValue, this._transitionResize);\n\n                this._transitionBox.x = newBox.x * this._transitValue + (1 - this._transitValue) * this._defaultBox.x;\n                this._transitionBox.y = newBox.y * this._transitValue + (1 - this._transitValue) * this._defaultBox.y;\n                this._transitionBox.width = newBox.width * this._transitValue + (1 - this._transitValue) * this._defaultBox.width;\n                this._transitionBox.height = newBox.height * this._transitValue + (1 - this._transitValue) * this._defaultBox.height;\n            };\n\n            this._transitTween.onComplete = () => {\n                this._isTransition = false;\n                this.defaultBox = newBox;\n            };\n\n            this._isTransition = true;\n        }\n    },\n\n    cancelTransition() {\n        this._transitTween && this._transitTween.stop();\n        this._transitValue = 0;\n        this._isTransition = false;\n\n        this.defaultBox = this._transitionBox;\n    },\n\n    _setTransitBox(newBox) {\n        if (!this._transitionBox) {\n            this._transitionBox = new cc.Node('CameraTransitionBox');\n        }\n\n        if (!this._transitionResize) {\n            this._transitionResize =\n                this._transitionBox.getComponent(pg.ResizeComponent) || this._transitionBox.addComponent(pg.ResizeComponent);\n        }\n\n        this._transitionBox.setParent(newBox.parent);\n    },\n});\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        //#region editors fields and properties\n\n        focus: {\n            default: cc.v2(0.5, 0.5),\n            tooltip: 'фокус камеры от 0 до 1 по каждой из осей',\n        },\n\n        isUsingCameraBoxes: {\n            default: false,\n            tooltip: 'использовать камера боксы. Если нет, предполагается что камера статична',\n        },\n\n        //#endregion\n\n        //#region editors fields and properties\n\n        boxHelper: {\n            default() {\n                return new CaptureBoxHelper();\n            },\n            visible() {\n                return this.isUsingCameraBoxes;\n            },\n            type: CaptureBoxHelper,\n        },\n\n        fitSpace: {\n            default: false,\n            visible() {\n                return this.isUsingCameraBoxes;\n            },\n            tooltip:\n                'если true, камера гарантирует попадание всей коробки, на false гарантируется покрытие камеры целиком (без черных полос)',\n        },\n\n        deltaShake: {\n            default: cc.Vec2.ZERO,\n            tooltip: 'вектор для шейка камеры. Задает направление и амплитуду',\n        },\n\n        shakeFrequency: {\n            default: cc.v2(1, 1),\n            tooltip: 'количество полных оборотов камеры по каждой оси за секунду',\n        },\n\n        //#endregion\n\n        //#region private field and properties\n\n        _camera: { default: null, serializable: false },\n        _boxes: { default: {}, serializable: false },\n        _currentShakeOffset: { default: cc.v2(), serializable: false },\n        _isShaking: { default: false, serializable: false },\n        _shakingTime: { default: 0, serializable: false },\n        _staticCameraPos: { default: cc.v2(), serializable: false },\n\n        //#endregion\n    },\n\n    editor: {\n        menu: 'Camera/CameraController2D',\n    },\n\n    //#region life-cycle callbacks\n\n    onLoad() {\n        if (!this._camera) {\n            this._camera = this.node.getComponent(cc.Camera);\n        }\n\n        this._handleSubscription(true);\n    },\n\n    onEnable() {\n        this._staticCameraPos = this.node.position.clone();\n    },\n\n    update(dt) {\n        this._updatePosition();\n        this._updateZoomRatio();\n\n        if (this._isShaking) {\n\n            this._shakingTime += dt;\n\n            // камера трясется по синусоиде с заданной частотой и амплитудой\n            const xOffset =\n                this.shakeFrequency.x > 0 ? Math.sin(Math.PI * this._shakingTime * this.shakeFrequency.x) * this.deltaShake.x : 0;\n            const yOffset =\n                this.shakeFrequency.y > 0 ? Math.sin(Math.PI * this._shakingTime * this.shakeFrequency.y) * this.deltaShake.y : 0;\n\n            this._currentShakeOffset = cc.v2(xOffset, yOffset);\n        }\n    },\n\n    //#endregion\n\n    //#region public methods\n    //#endregion\n\n    //#region private method\n    _handleSubscription(isOn) {\n        const func = isOn ? 'on' : 'off';\n\n        cc.systemEvent[func](GameEvent.CAMERA_TRANSIT_BOX, this.onCameraTransitBox, this);\n        cc.systemEvent[func](GameEvent.CAMERA_BOX_ADD, this.onCameraBoxAdd, this);\n        cc.systemEvent[func](GameEvent.CAMERA_BOX_SWITCH, this.onCameraBoxSwitch, this);\n        cc.systemEvent[func](GameEvent.CAMERA_START_SHAKE, this.onCameraStartShake, this);\n        cc.systemEvent[func](GameEvent.CAMERA_STOP_SHAKE, this.onCameraStopShake, this);\n    },\n\n    _updateZoomRatio() {\n        let zoomRatio = 1;\n\n        if (this.boxHelper.defaultBox) {\n            const tw = this.boxHelper.defaultBox.width;\n            const th = this.boxHelper.defaultBox.height;\n            const gw = pg.settings.GAME_WIDTH;\n            const gh = pg.settings.GAME_HEIGHT;\n            const zX = gw / tw;\n            const zY = gh / th;\n\n            zoomRatio = this.fitSpace ? Math.max(zX, zY) : Math.min(zX, zY);\n        }\n\n        this._setZoomRatio(zoomRatio);\n    },\n\n    _updatePosition() {\n        if (this.isUsingCameraBoxes && this.boxHelper.defaultBox) {\n            const targetWorldPosition = this.boxHelper.defaultBox.convertToWorldSpaceAR(cc.Vec2.ZERO);\n            const offset = cc.v2(\n                this._camera.width * (this.boxHelper.defaultBox.anchorX - this.focus.x),\n                this._camera.height * (this.boxHelper.defaultBox.anchorY - this.focus.y)\n            );\n            const cameraWorldPosition = targetWorldPosition.add(offset);\n\n            this._checkStickPosition(cameraWorldPosition);\n            const cameraLocalPosition = this.node.parent.convertToNodeSpaceAR(cameraWorldPosition);\n            this.node.setPosition(cameraLocalPosition.add(this._currentShakeOffset));\n        } else if (!this.isUsingCameraBoxes) {\n            this.node.setPosition(this._staticCameraPos.add(this._currentShakeOffset));\n        }\n    },\n\n    _checkStickPosition(cameraWorld) {\n        const viewSize = cc.view.getVisibleSize();\n\n        switch (this.boxHelper.stickMode) {\n            case StickModes.Top:\n                cameraWorld.y = cameraWorld.y - (this._camera.height - this.boxHelper.defaultBox.height) * 0.5;\n                break;\n\n            case StickModes.Bottom:\n                cameraWorld.y = cameraWorld.y + (this._camera.height - this.boxHelper.defaultBox.height) * 0.5;\n                break;\n\n            case StickModes.Right:\n                cameraWorld.x = cameraWorld.x - (this._camera.width - this.boxHelper.defaultBox.width) * 0.5;\n                break;\n\n            case StickModes.Left:\n                cameraWorld.x = cameraWorld.x + (this._camera.width - this.boxHelper.defaultBox.width) * 0.5;\n                break;\n        }\n    },\n\n    _setZoomRatio(zoomRatio) {\n        this._camera.zoomRatio = zoomRatio;\n        this._camera.width = pg.settings.GAME_WIDTH / this._camera.zoomRatio;\n        this._camera.height = pg.settings.GAME_HEIGHT / this._camera.zoomRatio;\n    },\n\n    //#endregion\n\n    //#region event handlers\n\n    onCameraTransitBox(newBox, duration = 0, easing) {\n        if (newBox) {\n            if (duration === 0) {\n                this.boxHelper.defaultBox = newBox;\n            } else {\n                this.boxHelper.transitToBox(newBox, duration, easing);\n            }\n        }\n    },\n\n    onCameraBoxAdd(type, box) {\n        if (box instanceof cc.Node) {\n            this._boxes[type] = box;\n        }\n    },\n\n    onCameraBoxSwitch(type, duration, easing) {\n        const newBox = this._boxes[type];\n\n        this.onCameraTransitBox(newBox, duration, easing);\n    },\n\n    onCameraStartShake() {\n        this._isShaking = true;\n    },\n\n    onCameraStopShake() {\n        this._isShaking = false;\n        this._currentShakeOffset = cc.v2();\n        this._shakingTime = 0;\n    },\n\n    //#endregion\n});\n"]}