{"version":3,"sources":["assets/scripts/Game/Ui/ScoreManager.js"],"names":["cc","Class","Component","properties","level","type","Label","steps","localScores","totalScores","progress","Node","_level","serializable","_steps","_stepsFirstLevels","_stepsNextLevels","_numberForAvailableCreation","_widthMultiplier","_scoresBorder","_localScores","_needingScores","_totalScores","_canCheckForScoresAbility","_isStopAdding","onEnable","_handleSubscription","_createNewLevel","string","onDisable","isOn","func","systemEvent","GameEvent","SCORE_GOT","onScoreGot","PLAYER_MOVED","onPlayerMoved","IS_SCORE_ENOUGH","onIsScoreEnough","TOGGLE_SUPER_ABILITY","onToggleSuperAbility","SHOW_SCREEN","onShowScreen","Math","ceil","width","_checkForScores","scores","comparedValue","emit","BOMB_IS_AVAILABLE","UiScreenType","Result","pg","tweenManager","add","kindSuperAbility","score","isAvailable","BlockColorType","Bomb","Teleport","BombType","Tnt","CREATE_SUPER_ABILITY","typeScreen","isShow","isWin"],"mappings":"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","sourceRoot":"/","sourcesContent":["//#region classes-helpers\nimport GameEvent from 'GameEvent';\nimport UiScreenType from 'UiScreenType';\nimport BombType from 'BombType';\nimport BlockColorType from '../Enums/BlockColorType';\n//#endregion\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        //#region editors fields and properties\n        level: { default: null, type: cc.Label },\n        steps: { default: null, type: cc.Label },\n        localScores: { default: null, type: cc.Label },\n        totalScores: { default: null, type: cc.Label },\n        progress: { default: null, type: cc.Node },\n\n        //#endregion\n\n        //#region public fields and properties\n        //#endregion\n\n        //#region private fields and properties\n        _level: { default: 0, serializable: false },\n        _steps: { default: 20 },\n        _stepsFirstLevels: { default: 10 },\n        _stepsNextLevels: { default: 21 },\n        _numberForAvailableCreation:{ default: 10 },\n        _widthMultiplier:{ default: 1500 },\n        _scoresBorder: { default: 18 },\n        _localScores: { default: 40 },\n        _needingScores: { default: 0, serializable: false },\n        _totalScores: { default: 0 },\n        _canCheckForScoresAbility: { default: true },\n        _isStopAdding: { default: false },\n        //#endregion\n    },\n\n    //#region life-cycle callbacks\n    onEnable() {\n        this._handleSubscription(true);\n        this._createNewLevel();\n        this.totalScores.string = this._totalScores;\n    },\n\n    onDisable() {\n        this._handleSubscription(false);\n    },\n\n    //#endregion\n\n    //#region public methods\n    //#endregion\n\n    //#region private methods\n    _handleSubscription(isOn) {\n        const func = isOn ? 'on' : 'off';\n\n        cc.systemEvent[func](GameEvent.SCORE_GOT, this.onScoreGot, this);\n        cc.systemEvent[func](GameEvent.PLAYER_MOVED, this.onPlayerMoved, this);\n        cc.systemEvent[func](GameEvent.IS_SCORE_ENOUGH, this.onIsScoreEnough, this);\n        cc.systemEvent[func](GameEvent.TOGGLE_SUPER_ABILITY, this.onToggleSuperAbility, this);\n        cc.systemEvent[func](GameEvent.SHOW_SCREEN, this.onShowScreen, this);\n    },\n\n    _createNewLevel() {\n        this._level += 1;\n        this._steps = this._stepsNextLevels - this._level;\n        if (this._steps < this._stepsFirstLevels) this._steps = this._stepsFirstLevels;\n        this._localScores = this._scoresBorder + Math.ceil(this._level * 2);\n        this._needingScores = this._localScores;\n        this.level.string = this._level;\n        this.localScores.string = this._localScores;\n        this.steps.string = this._steps;\n        this.progress.width = 0;\n    },\n\n    _checkForScores(scores, comparedValue) {\n        if (scores >= comparedValue) return true;\n        return false;\n    },\n\n    //#endregion\n\n    //#region event handlers\n    onScoreGot(scores) {\n        if (this._isStopAdding) return;\n        this._localScores -= scores;\n        this._totalScores += scores;\n        this.totalScores.string = this._totalScores;\n\n        if (this._checkForScores(this._totalScores, this._numberForAvailableCreation)) cc.systemEvent.emit(GameEvent.BOMB_IS_AVAILABLE, true);\n\n        if (this._localScores < 1) {\n            cc.systemEvent.emit(GameEvent.SHOW_SCREEN, UiScreenType.Result, true, true);\n            this._createNewLevel();\n        } else {\n            this.localScores.string = this._localScores;\n            pg.tweenManager.add(this.progress, { width: this._widthMultiplier * ((this._needingScores - this._localScores) / this._needingScores) }, 0.2);\n        }\n    },\n\n    onPlayerMoved() {\n        this._isStopAdding = false;\n        this._steps -= 1;\n        if (this._steps < 1) {\n            cc.systemEvent.emit(GameEvent.SHOW_SCREEN, UiScreenType.Result, true, false);\n        } else {\n            this.steps.string = this._steps;\n        }\n    },\n\n    onIsScoreEnough(kindSuperAbility, score) {\n        if (!this._canCheckForScoresAbility) return;\n        \n        let isAvailable = false;\n        switch (kindSuperAbility) {\n            case BlockColorType.Bomb:\n                if (this._totalScores >= score) {\n                    isAvailable = true;\n                    this._totalScores -= score;\n                    if (!this._checkForScores(this._totalScores, score)) cc.systemEvent.emit(GameEvent.BOMB_IS_AVAILABLE, false);\n                }\n                break;\n            case BlockColorType.Teleport:\n                if (this._totalScores >= score) {\n                    isAvailable = true;\n                    this._totalScores -= score;\n                }\n                break;\n    \n            case BombType.Tnt:\n                return\n                if (this._totalScores >= score) {\n                    isAvailable = true;\n                    this._totalScores -= score;\n                }\n                break;\n        }\n        if (isAvailable) {\n            cc.systemEvent.emit(GameEvent.CREATE_SUPER_ABILITY, kindSuperAbility);\n            this.totalScores.string = this._totalScores;\n        }\n    },\n\n    onToggleSuperAbility(isOn) {\n        this._canCheckForScoresAbility = isOn;\n    },\n\n    onShowScreen(typeScreen, isShow, isWin = true) {\n        this._isStopAdding = true;\n        if (isWin) return;\n        this._level = 0;\n        this._totalScores = 0;\n        this.totalScores.string = this._totalScores;\n        this._localScores = 0;\n        this._createNewLevel();\n    },\n    //#endregion\n});\n"]}