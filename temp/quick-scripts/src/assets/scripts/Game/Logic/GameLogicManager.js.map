{"version":3,"sources":["assets/scripts/Game/Logic/GameLogicManager.js"],"names":["cc","Class","Component","properties","numeralToDestroy","_field","type","Node","serializable","_numeralStrings","_numeralColumns","_widthColumn","_widthOffset","_highColumn","_highOffset","_numberColors","_blocksArray","_tempCoalitionArray","_numeralToDestroy","_numeralFallBlocks","_stopSuperAbility","_isScoreEnoughForBomb","_isScoreEnoughForTeleport","_amountBlocksForEraserAppearing","_isFieldOn","_isTeleportMode","onEnable","_handleSubscription","onDisable","isOn","func","systemEvent","GameEvent","FIELD_ON","onFieldOn","BLOCK_CHOSEN","onBlockChosen","BLOCK_FALL","onBlockFall","CREATE_SUPER_ABILITY","onCreateSuperAbility","BOMB_IS_AVAILABLE","onBombIsAvailable","TELEPORT_IS_AVAILABLE","onTeleportIsAvailable","FEATURE_RESULT","onFeatureResult","TELEPORTATION_COMPLETE","onTeleportationComplete","START_TELEPORTATION","onStartTeleportation","_createBlockArray","id","i","j","position","_setLocation","_createBlock","iI","iJ","newBlock","instantiate","_block","kind","_chooseColor","setParent","setPosition","active","coalition","transferred","y","x","v2","Math","ceil","random","_findCoalition","block","push","_checkOnShuffle","_numeralCoalition","length","_checkClickedBlock","kindSuperAbility","_resetCoalition","BlockColorType","Bomb","emit","TOGGLE_SUPER_ABILITY","BLOCK_BOMB_DONE","BLOCK_BOMB_CHOSEN","ColumnEraser","COLUMN_ERASER_DONE","ACTIVATE_COLUMN_ERASER","BLOCK_CAN_BE_CHOSEN","_finalChecking","_transferBlocksUp","_columnsArray","SCORE_GOT","forEach","element","SPAWN_EFFECT","convertToWorldSpaceAR","opacity","newI","CAMERA_START_SHAKE","scheduleOnce","CAMERA_STOP_SHAKE","CHOOSE_COLOR_BLOCK","_regularizeTransferredBlocks","lengthBlockArray","k","_lastFallingBlock","splice","removeFromParent","addChild","SHOW_SCREEN","UiScreenType","Result","PLAYER_MOVED","TIME_TO_FALL","_findIndexes","blockId","_findID","coords","_useAbilityTnt","kindAbility","Teleport","TELEPORT_STARTED","newID","CREATE_SUPER_BLOCK","field","TELEPORTED_BLOCK_CHOSEN","STOP_INPUT","isAvailable","numbersArray","first","second"],"mappings":"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","sourceRoot":"/","sourcesContent":["//#region classes-helpers\nimport GameEvent from 'GameEvent';\nimport BlockColorType from 'BlockColorType';\nimport UiScreenType from 'UiScreenType';\nimport EffectType from 'EffectType';\n\n//#endregion\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        //#region editors fields and properties\n        numeralToDestroy: { default: 3 },\n        //#endregion\n\n        //#region public fields and properties\n        //#endregion\n\n        //#region private fields and properties\n        _field: { default: null, type: cc.Node, serializable: false },\n        _numeralStrings: { default: 7, serializable: false },\n        _numeralColumns: { default: 10, serializable: false },\n        _widthColumn: { default: 155, serializable: false },\n        _widthOffset: { default: 697, serializable: false },\n        _highColumn: { default: 233, serializable: false },\n        _highOffset: { default: 700, serializable: false },\n        _numberColors: { default: 5, serializable: false },\n        _blocksArray: { default: [], serializable: false },\n        _tempCoalitionArray: { default: [], serializable: false },\n        _numeralToDestroy: { default: 3, serializable: false },\n        _numeralFallBlocks: { default: 0, serializable: false },\n        _stopSuperAbility: { default: false, serializable: false },\n        _isScoreEnoughForBomb: { default: false, serializable: false },\n        _isScoreEnoughForTeleport: { default: false, serializable: false },\n        _amountBlocksForEraserAppearing: { default: 5, serializable: false },\n        _isFieldOn: { default: false, serializable: false },\n        _isTeleportMode: { default: false, serializable: false },\n\n\n        //#endregion\n    },\n\n    //#region life-cycle callbacks\n    onEnable() {\n        this._handleSubscription(true);\n        this._numeralToDestroy = this.numeralToDestroy;\n    },\n\n    onDisable() {\n        this._handleSubscription(false);\n    },\n\n    //#endregion\n\n    //#region private methods\n    _handleSubscription(isOn) {\n        const func = isOn ? 'on' : 'off';\n\n        cc.systemEvent[func](GameEvent.FIELD_ON, this.onFieldOn, this);\n        cc.systemEvent[func](GameEvent.BLOCK_CHOSEN, this.onBlockChosen, this);\n        cc.systemEvent[func](GameEvent.BLOCK_FALL, this.onBlockFall, this);\n        cc.systemEvent[func](GameEvent.CREATE_SUPER_ABILITY, this.onCreateSuperAbility, this);\n        cc.systemEvent[func](GameEvent.BOMB_IS_AVAILABLE, this.onBombIsAvailable, this);\n        cc.systemEvent[func](GameEvent.TELEPORT_IS_AVAILABLE, this.onTeleportIsAvailable, this);\n        cc.systemEvent[func](GameEvent.FEATURE_RESULT, this.onFeatureResult, this);\n        cc.systemEvent[func](GameEvent.TELEPORTATION_COMPLETE, this.onTeleportationComplete, this);\n        cc.systemEvent[func](GameEvent.START_TELEPORTATION, this.onStartTeleportation, this);\n    },\n\n    _createBlockArray() {\n        this._blocksArray = [];\n        let id = 1;\n        for (let i = 0; i < this._numeralColumns; i += 1) {\n            for (let j = 0; j < this._numeralStrings; j += 1) {\n                const position = this._setLocation(j, i);\n                if (!this._blocksArray[j]) this._blocksArray[j] = [];\n                this._blocksArray[j][i] = this._createBlock(position);\n                this._blocksArray[j][i].id = id;\n                this._blocksArray[j][i].iI = j;\n                this._blocksArray[j][i].iJ = i;\n                id += 1;\n            }\n        }\n    },\n\n    _createBlock(position) {\n        const newBlock = cc.instantiate(this._block);\n        newBlock.kind = this._chooseColor();\n        newBlock.setParent(this._field);\n        newBlock.setPosition(position);\n        newBlock.active = true;\n        newBlock.coalition = 0;\n        newBlock.transferred = 0;\n        return newBlock;\n    },\n\n    _setLocation(y, x) {\n        return cc.v2(x * this._widthColumn - this._widthOffset, y * this._highColumn - this._highOffset);\n    },\n\n    _chooseColor() {\n        return Math.ceil(Math.random() * this._numberColors) - 1;\n    },\n\n    _findCoalition(block, kind, coalition) {\n        if ((block && block.iI < 0) || block.iI > this._numeralStrings - 1 || block.iJ < 0 || block.iJ > this._numeralColumns - 1) {\n            return;\n        }\n\n        if (block.coalition !== 0 || block.kind !== kind) {\n            return;\n        }\n\n        block.coalition = coalition;\n        this._tempCoalitionArray.push(block);\n\n        if (this._blocksArray[block.iI - 1] && this._blocksArray[block.iI - 1][block.iJ])\n            this._findCoalition(this._blocksArray[block.iI - 1][block.iJ], kind, coalition);\n        if (this._blocksArray[block.iI + 1] && this._blocksArray[block.iI + 1][block.iJ])\n            this._findCoalition(this._blocksArray[block.iI + 1][block.iJ], kind, coalition);\n        if (this._blocksArray[block.iI] && this._blocksArray[block.iI][block.iJ - 1])\n            this._findCoalition(this._blocksArray[block.iI][block.iJ - 1], kind, coalition);\n        if (this._blocksArray[block.iI] && this._blocksArray[block.iI][block.iJ + 1])\n            this._findCoalition(this._blocksArray[block.iI][block.iJ + 1], kind, coalition);\n    },\n\n    _checkOnShuffle() {\n        this._numeralCoalition = 1;\n        this._tempCoalitionArray = [];\n        for (let i = 0; i < this._numeralStrings; i += 1) {\n            for (let j = 0; j < this._numeralColumns - 1; j += 1) {\n                this._findCoalition(this._blocksArray[i][j], this._blocksArray[i][j].kind, this._numeralCoalition);\n                if (this._tempCoalitionArray.length >= this._numeralToDestroy) this._numeralCoalition += 1;\n                this._tempCoalitionArray = [];\n                if (this._numeralCoalition > 1) return true;\n            }\n        }\n        return false;\n    },\n\n    _checkClickedBlock(block, kindSuperAbility = 0) {\n\n        this._resetCoalition();\n\n        this._tempCoalitionArray = [];\n\n        switch (kindSuperAbility) {\n            case BlockColorType.Bomb:\n                cc.systemEvent.emit(GameEvent.TOGGLE_SUPER_ABILITY, true);\n                this._stopSuperAbility = false;\n                cc.systemEvent.emit(GameEvent.BLOCK_BOMB_DONE,block.id);\n                cc.systemEvent.emit(GameEvent.BLOCK_BOMB_CHOSEN, [block.iI,block.iJ], this._numeralColumns, this._numeralStrings);                    \n                break;\n            \n            case BlockColorType.ColumnEraser:\n                cc.systemEvent.emit(GameEvent.TOGGLE_SUPER_ABILITY, true);\n                this._stopSuperAbility = false;\n                cc.systemEvent.emit(GameEvent.COLUMN_ERASER_DONE,block.id);\n                cc.systemEvent.emit(GameEvent.ACTIVATE_COLUMN_ERASER, [block.iI,block.iJ], this._numeralColumns, this._numeralStrings);                    \n                break;\n            \n            default:\n                this._findCoalition(block, block.kind, 1);\n\n                if (this._tempCoalitionArray.length < this._numeralToDestroy) {\n                    this._resetCoalition();\n                    cc.systemEvent.emit(GameEvent.BLOCK_CAN_BE_CHOSEN);\n                    return;\n                }\n    \n                if (this._tempCoalitionArray.length > this._amountBlocksForEraserAppearing - 1) {\n                    this.onCreateSuperAbility(BlockColorType.ColumnEraser ,cc.v2(block.iI, block.iJ));\n                }\n                \n                this._finalChecking();    \n                break;\n        }\n    },\n\n    _transferBlocksUp() {\n        let _columnsArray =[];\n        for (let i = 0; i < this._numeralColumns; i++) {\n            _columnsArray.push(0);\n        }\n\n        this._numeralFallBlocks = this._tempCoalitionArray.length;\n        cc.systemEvent.emit(GameEvent.SCORE_GOT, this._numeralFallBlocks);\n        \n        this._tempCoalitionArray.forEach((element) => {\n         cc.systemEvent.emit(GameEvent.SPAWN_EFFECT, element.convertToWorldSpaceAR(cc.v2(0, 0)));\n            element.opacity = 0;\n\n            let newI = this._numeralStrings + _columnsArray[element.iJ];\n\n\n            cc.systemEvent.emit(GameEvent.CAMERA_START_SHAKE);\n            this.scheduleOnce(() => {\n                cc.systemEvent.emit(GameEvent.CAMERA_STOP_SHAKE);\n            }, 0.2);\n\n            element.y = this._setLocation(newI, element.iJ).y;\n\n            _columnsArray[element.iJ] += 1;\n            element.kind = this._chooseColor();\n            cc.systemEvent.emit(GameEvent.CHOOSE_COLOR_BLOCK, element.id, element.kind);\n\n            if (!this._blocksArray[newI]) this._blocksArray[newI] = [];\n\n            this._blocksArray[newI][element.iJ] = element;\n\n            this._blocksArray[element.iI][element.iJ] = null;\n\n            for (let i = element.iI; i < this._numeralStrings + _columnsArray[element.iJ]; i += 1) {\n                if (this._blocksArray[i][element.iJ]) {\n                    this._blocksArray[i][element.iJ].transferred += 1;\n                }\n            }\n\n            element.transferred = newI - this._numeralStrings;\n            element.transferred ++;\n\n            element.iI = newI;\n        });\n    },\n\n    _regularizeTransferredBlocks() {\n        const lengthBlockArray = this._blocksArray.length;\n\n        for (let i = this._numeralStrings; i < lengthBlockArray; i += 1) {\n            for (let j = 0; j < this._numeralColumns; j += 1) {\n                if (this._blocksArray[i] && this._blocksArray[i][j]) {\n                    for (let k = 0; k < lengthBlockArray; k += 1) {\n                        if (this._blocksArray[k] && this._blocksArray[k][j] && this._blocksArray[k][j].transferred > 0) {\n                            this._blocksArray[k - this._blocksArray[k][j].transferred][j] = this._blocksArray[k][j];\n                            this._blocksArray[k - this._blocksArray[k][j].transferred][j].iI = k - this._blocksArray[k][j].transferred;\n                            this._blocksArray[k - this._blocksArray[k][j].transferred][j].transferred = 0;\n                            this._blocksArray[k - this._blocksArray[k][j].transferred][j].coalition = 0;\n                        }\n                    }\n                }\n            }\n        }\n        this._lastFallingBlock = lengthBlockArray - this._numeralStrings;\n        this._blocksArray.splice(this._numeralStrings, lengthBlockArray - this._numeralStrings);\n\n        for (let i = 0; i < this._numeralStrings; i += 1) {\n            for (let j = 0; j < this._numeralColumns; j += 1) {\n                this._blocksArray[i][j].removeFromParent();\n                this._field.addChild(this._blocksArray[i][j]);\n            }\n        }\n\n        if (!this._checkOnShuffle() && !this._isScoreEnoughForBomb) {\n            this._createBlockArray();\n            if (!this._checkOnShuffle()) {\n                cc.systemEvent.emit(GameEvent.SHOW_SCREEN, UiScreenType.Result, true, false);\n                while (!this._checkOnShuffle()) {\n                    this._createBlockArray();\n                }\n            }\n        }\n    },\n\n    _resetCoalition() {\n        for (let i = 0; i < this._numeralStrings; i += 1) {\n            for (let j = 0; j < this._numeralColumns; j += 1) {\n                this._blocksArray[i][j].coalition = 0;\n            }\n        }\n    },\n\n    _finalChecking() {\n        cc.systemEvent.emit(GameEvent.PLAYER_MOVED);\n\n        this._transferBlocksUp();\n\n        cc.systemEvent.emit(GameEvent.TIME_TO_FALL);\n\n        this._regularizeTransferredBlocks();\n\n        this._resetCoalition();\n    },\n\n    _findIndexes(blockId) {\n        for (let i = 0; i < this._numeralStrings; i += 1) {\n            for (let j = 0; j < this._numeralColumns; j += 1) {\n                if (this._blocksArray[i][j].id === blockId) return cc.v2(i, j);\n            }\n        }\n    },\n\n    _findID(coords) {\n        for (let i = 0; i < this._numeralStrings; i += 1) {\n            for (let j = 0; j < this._numeralColumns; j += 1) {\n                if (this._blocksArray[i][j].iI === coords.x && this._blocksArray[i][j].iJ === coords.y) \n                    return this._blocksArray[i][j].id;\n            }\n        }\n    },\n\n    _useAbilityTnt(block) {\n        this._createBlockArray();\n        cc.systemEvent.emit(GameEvent.SCORE_GOT, this._numeralColumns * this._numeralStrings);\n    },\n    //#endregion\n\n    //#region event handlers\n    onCreateSuperAbility(kindAbility, coords = cc.v2(-1, -1)) {\n\n        if (this._stopSuperAbility) \n            return;\n        cc.systemEvent.emit(GameEvent.TOGGLE_SUPER_ABILITY, false);\n        this._stopSuperAbility = true;\n\n        if (kindAbility === BlockColorType.Teleport) {\n            this.onTeleportIsAvailable(true);\n            cc.systemEvent.emit(GameEvent.TELEPORT_STARTED);\n            return\n        }\n\n        this.scheduleOnce(()=>{\n            let newID\n            if (coords.x < 0) {\n                newID = Math.ceil(Math.random() * (this._numeralStrings * this._numeralColumns - 1));\n            } else {\n                newID = this._findID(coords);\n            }\n            \n            cc.systemEvent.emit(GameEvent.CREATE_SUPER_BLOCK, newID, kindAbility);    \n        },0.1)\n    },\n\n    onFieldOn(field, block) {\n        \n        this._isFieldOn = true;\n        \n        this._field = field;\n        this._block = block;\n        if (this._field && this._block) {\n            this._createBlockArray();\n        }\n\n        while (!this._checkOnShuffle()) {\n            this._createBlockArray();\n        }\n    },\n\n    onBlockChosen(block) {\n\n        if (this._isTeleportMode) {\n            cc.systemEvent.emit(GameEvent.TELEPORTED_BLOCK_CHOSEN, block);            \n            return\n        }\n        \n        cc.systemEvent.emit(GameEvent.STOP_INPUT);\n        let kindSuperAbility = 0;\n        if (block.kind === BlockColorType.Bomb || block.kind === BlockColorType.ColumnEraser) {\n            kindSuperAbility = block.kind;\n        }\n        this._checkClickedBlock(block, kindSuperAbility);\n    },\n\n    onBlockFall(transferred) {\n        if (transferred === this._lastFallingBlock) {\n            this.scheduleOnce(() => {\n                cc.systemEvent.emit(GameEvent.BLOCK_CAN_BE_CHOSEN);\n            }, 0.35);\n        }\n    },\n\n    onBombIsAvailable(isAvailable) {\n        this._isScoreEnoughForBomb = isAvailable;\n    },\n\n    onTeleportIsAvailable(isAvailable) {\n        this._isScoreEnoughForTeleport = isAvailable;\n        this._isTeleportMode = true;\n    },\n\n\n    onFeatureResult(numbersArray) {\n        numbersArray.forEach(element => {\n            this._tempCoalitionArray.push(this._blocksArray[element[1]][element[0]]);     \n        });\n         \n        this._finalChecking();\n    },\n\n    onTeleportationComplete() {        \n        this._stopSuperAbility = false;\n        cc.systemEvent.emit(GameEvent.TOGGLE_SUPER_ABILITY, true);\n        this._regularizeTransferredBlocks();\n    },\n\n    onStartTeleportation(first, second) {\n        this._isTeleportMode = false;\n        this._blocksArray[first.iI][first.iJ] = second;\n        this._blocksArray[second.iI][second.iJ] = first;\n        [first.iI, second.iI] = [second.iI, first.iI];\n        [first.iJ, second.iJ] = [second.iJ, first.iJ];\n        this._resetCoalition();\n    }\n    //#endregion\n});\n"]}