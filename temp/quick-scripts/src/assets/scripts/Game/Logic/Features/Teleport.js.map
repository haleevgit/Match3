{"version":3,"sources":["assets/scripts/Game/Logic/Features/Teleport.js"],"names":["cc","Class","Feature","properties","_firstTeleportPosition","v2","serializable","_secondTeleportPosition","_handleSubscription","isOn","func","systemEvent","initializingEvent","onInitializingEvent","GameEvent","TELEPORTED_BLOCK_CHOSEN","onTeleportBlockChosen","_logic","emit","CHANGE_BLOCK_ANIMATION","TeleportAnimationsType","Choosing","block","_firstBlockId","_firstBlock","id","_firstCoord","x","y","_secondBlockId","None","iI","iJ","Accepted","_secondCoord","START_TELEPORTATION","featureCoordinate","fieldWidth","fieldHeight"],"mappings":"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","sourceRoot":"/","sourcesContent":["//#region classes-helpers\nimport GameEvent from 'GameEvent';\nimport Feature from 'Feature';\nimport TeleportAnimationsType from 'TeleportAnimationsType';\n//#endregion\n \ncc.Class({\n    extends: Feature,\n\n    properties: {\n        _firstTeleportPosition: { default: cc.v2(6,4), serializable: false },\n        _secondTeleportPosition: { default: cc.v2(6,7), serializable: false },\n    },\n  \n    //#region life-cycle callbacks\n\n    _handleSubscription(isOn) {\n        const func = isOn ? 'on' : 'off';\n \n        cc.systemEvent[func](this.initializingEvent, this.onInitializingEvent, this);\n        cc.systemEvent[func](GameEvent.TELEPORTED_BLOCK_CHOSEN, this.onTeleportBlockChosen, this);\n    },\n\n    _logic() {\n        //надо запретить покупать телепорт, если на экране бомба\n        //отправляем команду в скрипт среднего блока, чтобы он включил себе другую анимацию\n        cc.systemEvent.emit(GameEvent.CHANGE_BLOCK_ANIMATION, this._firstTeleportPosition, TeleportAnimationsType.Choosing);\n    },\n\n    onTeleportBlockChosen(block) {\n        // обнуление всех переменных, возврат всех анимаций назад\n        if (!this._firstBlockId) {\n            this._firstBlock = block;\n            this._firstBlockId = block.id;\n            this._firstCoord = cc.v2(block.x, block.y);\n            this._secondBlockId = -1;\n            cc.systemEvent.emit(GameEvent.CHANGE_BLOCK_ANIMATION, this._firstTeleportPosition, TeleportAnimationsType.None);\n            cc.systemEvent.emit(GameEvent.CHANGE_BLOCK_ANIMATION, cc.v2(block.iI, block.iJ), TeleportAnimationsType.Accepted);\n            if (block.iJ === 7) {\n                this._secondTeleportPosition.x = 5;\n            }\n            cc.systemEvent.emit(GameEvent.CHANGE_BLOCK_ANIMATION, this._secondTeleportPosition, TeleportAnimationsType.Choosing);\n        } else {\n            this._secondBlockId = block.id;\n            this._secondCoord = cc.v2(block.x, block.y);\n            cc.systemEvent.emit(GameEvent.CHANGE_BLOCK_ANIMATION, this._secondTeleportPosition, TeleportAnimationsType.None);\n            cc.systemEvent.emit(GameEvent.CHANGE_BLOCK_ANIMATION, cc.v2(block.iI, block.iJ), TeleportAnimationsType.Accepted);\n            cc.systemEvent.emit(GameEvent.START_TELEPORTATION, this._firstBlock, block, this._firstCoord, this._secondCoord);\n            this._firstBlockId = false;\n        }\n    },\n\n    onInitializingEvent(featureCoordinate, fieldWidth, fieldHeight) {\n        this._logic();\n    }\n });\n \n"]}