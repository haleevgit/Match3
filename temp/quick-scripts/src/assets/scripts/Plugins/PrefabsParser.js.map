{"version":3,"sources":["assets/scripts/Plugins/PrefabsParser.js"],"names":["cc","Class","Component","properties","targetJson","type","JsonAsset","String","tooltip","EXPORT","get","set","value","exportJSON","_getJsonObject","content","JSON","stringify","downloadElement","document","createElement","file","Blob","href","URL","createObjectURL","name","node","download","click","editor","menu","jsonObject","jsonArray","children","forEach","child","i","length","property","_parseValue","push","isArray","Array","obj","allowedProps","constructor","__values__","array"],"mappings":"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","sourceRoot":"/","sourcesContent":["//#region import\n//#endregion\n\n//#region classes-helpers\n//#endregion\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        //#region editors fields and properties\n        targetJson: {\n            default: null,\n            type: cc.JsonAsset,\n        },\n\n        properties: { default: [], type: cc.String, tooltip: 'Названия параметров ноды - position/angle/scale и т.д. Кроме name' },\n\n        EXPORT: {\n            get() {\n                return false;\n            },\n\n            set(value) {\n                if (value) {\n                    const exportJSON = this._getJsonObject();\n\n                    let content = JSON.stringify(exportJSON);\n                    let downloadElement = document.createElement('a');\n                    let file = new Blob([content], { type: 'application/json' });\n\n                    downloadElement.href = URL.createObjectURL(file);\n\n                    const name = (this.targetJson ? this.targetJson.name : 'Export' + this.node.name) + '.json';\n\n                    downloadElement.download = name;\n                    downloadElement.click();\n                }\n            },\n        },\n        //#endregion\n        //#region public fields and properties\n        //#endregion\n        //#region private fields and properties\n        //#endregion\n    },\n\n    editor: {\n        menu: 'PrefabsParser/PrefabsParser',\n    },\n\n    //#region life-cycle callbacks\n\n    //  onLoad() { },\n    //  start() { },\n    //  onEnable() { },\n    //  onDisable() { },\n    //  update(dt) { },\n    //  onDestroy() { },\n\n    //#endregion\n\n    //#region public methods\n    //#endregion\n\n    //#region private methods\n    _getJsonObject() {\n        const node = this.node;\n        let jsonObject;\n        let jsonArray = [];\n\n        node.children.forEach((child) => {\n            jsonObject = {};\n            jsonObject['name'] = child.name;\n            for (let i = 0; i < this.properties.length; i += 1) {\n                const property = child[this.properties[i]];\n                jsonObject[this.properties[i]] = this._parseValue(property);\n            }\n\n            jsonArray.push(jsonObject);\n        });\n\n        return jsonArray;\n    },\n\n    _parseValue(value) {\n        const isArray = Array.isArray(value);\n\n        if (!isArray) {\n            if (typeof value === 'object') {\n                const obj = {};\n                const allowedProps = value.constructor.__values__;\n\n                for (let i = 0; i < allowedProps.length; i += 1) {\n                    obj[allowedProps[i]] = this._parseValue(value[allowedProps[i]]);\n                }\n\n                return obj;\n            } else {\n                return value;\n            }\n        } else {\n            const array = [];\n\n            for (let i = 0; i < value.length; i += 1) {\n                array.push(this._parseValue(value[i]));\n            }\n\n            return array;\n        }\n    },\n    //#endregion\n\n    //#region event handlers\n    //#endregion\n});\n\n//#region export\n//#endregion\n"]}