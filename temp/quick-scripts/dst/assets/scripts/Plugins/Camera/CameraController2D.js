
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/scripts/Plugins/Camera/CameraController2D.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '8e8040IYd5NGrcXp6vqHg01', 'CameraController2D');
// scripts/Plugins/Camera/CameraController2D.js

"use strict";

var _GameEvent = _interopRequireDefault(require("GameEvent"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

//#region import
//#endregion
var StickModes = cc.Enum({
  None: 0,
  Top: 1,
  Bottom: 2,
  Right: 3,
  Left: 4
});
var CaptureBoxHelper = cc.Class({
  name: 'CaptureBoxHelper',
  properties: {
    //#region editors fields and properties
    stickMode: {
      "default": StickModes.Bottom,
      type: StickModes,
      tooltip: 'к какой стороне экрана прилипает изображение'
    },
    defaultBox: {
      type: cc.Node,
      get: function get() {
        return this._isTransition && this._transitionBox ? this._transitionBox : this._defaultBox;
      },
      set: function set(box) {
        if (box instanceof cc.Node) {
          this._defaultBox = box;
        }
      },
      tooltip: 'начальная коробка, на которую смотрит камера'
    },
    //#endregion
    //#region private field and properties
    _defaultBox: {
      "default": null,
      type: cc.Node
    },
    _isTransition: {
      "default": false,
      serializable: false
    },
    _transitTween: {
      "default": null,
      type: pg.Tween,
      serializable: false
    },
    _transitValue: {
      "default": 0,
      serializable: false
    },
    _transitionBox: {
      "default": null,
      type: cc.Node,
      serializable: false
    },
    _transitionResize: {
      "default": null,
      type: pg.ResizeComponent,
      serializable: false
    } //#endregion

  },
  transitToBox: function transitToBox(newBox, duration, easing) {
    var _this = this;

    this._isTransition && this.cancelTransition();
    this._transitValue = 0;
    this._transitTween = pg.tweenManager.add(this, {
      _transitValue: 1
    }, duration, easing);

    this._setTransitBox(newBox);

    var defaultBoxResize = this.defaultBox.getComponent(pg.ResizeComponent);
    var newBoxResize = newBox.getComponent(pg.ResizeComponent);

    if (defaultBoxResize && newBoxResize) {
      this._transitionResize.set(defaultBoxResize);

      var initialPos = this.defaultBox.position.clone();

      this._transitTween.onUpdate = function () {
        // FIXME: lerp resize with absolute position
        //defaultBoxResize.lerp(newBoxResize, this._transitValue, this._transitionResize);
        _this._transitionBox.x = newBox.x * _this._transitValue + (1 - _this._transitValue) * _this._defaultBox.x;
        _this._transitionBox.y = newBox.y * _this._transitValue + (1 - _this._transitValue) * _this._defaultBox.y;
        _this._transitionBox.width = newBox.width * _this._transitValue + (1 - _this._transitValue) * _this._defaultBox.width;
        _this._transitionBox.height = newBox.height * _this._transitValue + (1 - _this._transitValue) * _this._defaultBox.height;
      };

      this._transitTween.onComplete = function () {
        _this._isTransition = false;
        _this.defaultBox = newBox;
      };

      this._isTransition = true;
    }
  },
  cancelTransition: function cancelTransition() {
    this._transitTween && this._transitTween.stop();
    this._transitValue = 0;
    this._isTransition = false;
    this.defaultBox = this._transitionBox;
  },
  _setTransitBox: function _setTransitBox(newBox) {
    if (!this._transitionBox) {
      this._transitionBox = new cc.Node('CameraTransitionBox');
    }

    if (!this._transitionResize) {
      this._transitionResize = this._transitionBox.getComponent(pg.ResizeComponent) || this._transitionBox.addComponent(pg.ResizeComponent);
    }

    this._transitionBox.setParent(newBox.parent);
  }
});
cc.Class({
  "extends": cc.Component,
  properties: {
    //#region editors fields and properties
    focus: {
      "default": cc.v2(0.5, 0.5),
      tooltip: 'фокус камеры от 0 до 1 по каждой из осей'
    },
    isUsingCameraBoxes: {
      "default": false,
      tooltip: 'использовать камера боксы. Если нет, предполагается что камера статична'
    },
    //#endregion
    //#region editors fields and properties
    boxHelper: {
      "default": function _default() {
        return new CaptureBoxHelper();
      },
      visible: function visible() {
        return this.isUsingCameraBoxes;
      },
      type: CaptureBoxHelper
    },
    fitSpace: {
      "default": false,
      visible: function visible() {
        return this.isUsingCameraBoxes;
      },
      tooltip: 'если true, камера гарантирует попадание всей коробки, на false гарантируется покрытие камеры целиком (без черных полос)'
    },
    deltaShake: {
      "default": cc.Vec2.ZERO,
      tooltip: 'вектор для шейка камеры. Задает направление и амплитуду'
    },
    shakeFrequency: {
      "default": cc.v2(1, 1),
      tooltip: 'количество полных оборотов камеры по каждой оси за секунду'
    },
    //#endregion
    //#region private field and properties
    _camera: {
      "default": null,
      serializable: false
    },
    _boxes: {
      "default": {},
      serializable: false
    },
    _currentShakeOffset: {
      "default": cc.v2(),
      serializable: false
    },
    _isShaking: {
      "default": false,
      serializable: false
    },
    _shakingTime: {
      "default": 0,
      serializable: false
    },
    _staticCameraPos: {
      "default": cc.v2(),
      serializable: false
    } //#endregion

  },
  editor: {
    menu: 'Camera/CameraController2D'
  },
  //#region life-cycle callbacks
  onLoad: function onLoad() {
    if (!this._camera) {
      this._camera = this.node.getComponent(cc.Camera);
    }

    this._handleSubscription(true);
  },
  onEnable: function onEnable() {
    this._staticCameraPos = this.node.position.clone();
  },
  update: function update(dt) {
    this._updatePosition();

    this._updateZoomRatio();

    if (this._isShaking) {
      this._shakingTime += dt; // камера трясется по синусоиде с заданной частотой и амплитудой

      var xOffset = this.shakeFrequency.x > 0 ? Math.sin(Math.PI * this._shakingTime * this.shakeFrequency.x) * this.deltaShake.x : 0;
      var yOffset = this.shakeFrequency.y > 0 ? Math.sin(Math.PI * this._shakingTime * this.shakeFrequency.y) * this.deltaShake.y : 0;
      this._currentShakeOffset = cc.v2(xOffset, yOffset);
    }
  },
  //#endregion
  //#region public methods
  //#endregion
  //#region private method
  _handleSubscription: function _handleSubscription(isOn) {
    var func = isOn ? 'on' : 'off';
    cc.systemEvent[func](_GameEvent["default"].CAMERA_TRANSIT_BOX, this.onCameraTransitBox, this);
    cc.systemEvent[func](_GameEvent["default"].CAMERA_BOX_ADD, this.onCameraBoxAdd, this);
    cc.systemEvent[func](_GameEvent["default"].CAMERA_BOX_SWITCH, this.onCameraBoxSwitch, this);
    cc.systemEvent[func](_GameEvent["default"].CAMERA_START_SHAKE, this.onCameraStartShake, this);
    cc.systemEvent[func](_GameEvent["default"].CAMERA_STOP_SHAKE, this.onCameraStopShake, this);
  },
  _updateZoomRatio: function _updateZoomRatio() {
    var zoomRatio = 1;

    if (this.boxHelper.defaultBox) {
      var tw = this.boxHelper.defaultBox.width;
      var th = this.boxHelper.defaultBox.height;
      var gw = pg.settings.GAME_WIDTH;
      var gh = pg.settings.GAME_HEIGHT;
      var zX = gw / tw;
      var zY = gh / th;
      zoomRatio = this.fitSpace ? Math.max(zX, zY) : Math.min(zX, zY);
    }

    this._setZoomRatio(zoomRatio);
  },
  _updatePosition: function _updatePosition() {
    if (this.isUsingCameraBoxes && this.boxHelper.defaultBox) {
      var targetWorldPosition = this.boxHelper.defaultBox.convertToWorldSpaceAR(cc.Vec2.ZERO);
      var offset = cc.v2(this._camera.width * (this.boxHelper.defaultBox.anchorX - this.focus.x), this._camera.height * (this.boxHelper.defaultBox.anchorY - this.focus.y));
      var cameraWorldPosition = targetWorldPosition.add(offset);

      this._checkStickPosition(cameraWorldPosition);

      var cameraLocalPosition = this.node.parent.convertToNodeSpaceAR(cameraWorldPosition);
      this.node.setPosition(cameraLocalPosition.add(this._currentShakeOffset));
    } else if (!this.isUsingCameraBoxes) {
      this.node.setPosition(this._staticCameraPos.add(this._currentShakeOffset));
    }
  },
  _checkStickPosition: function _checkStickPosition(cameraWorld) {
    var viewSize = cc.view.getVisibleSize();

    switch (this.boxHelper.stickMode) {
      case StickModes.Top:
        cameraWorld.y = cameraWorld.y - (this._camera.height - this.boxHelper.defaultBox.height) * 0.5;
        break;

      case StickModes.Bottom:
        cameraWorld.y = cameraWorld.y + (this._camera.height - this.boxHelper.defaultBox.height) * 0.5;
        break;

      case StickModes.Right:
        cameraWorld.x = cameraWorld.x - (this._camera.width - this.boxHelper.defaultBox.width) * 0.5;
        break;

      case StickModes.Left:
        cameraWorld.x = cameraWorld.x + (this._camera.width - this.boxHelper.defaultBox.width) * 0.5;
        break;
    }
  },
  _setZoomRatio: function _setZoomRatio(zoomRatio) {
    this._camera.zoomRatio = zoomRatio;
    this._camera.width = pg.settings.GAME_WIDTH / this._camera.zoomRatio;
    this._camera.height = pg.settings.GAME_HEIGHT / this._camera.zoomRatio;
  },
  //#endregion
  //#region event handlers
  onCameraTransitBox: function onCameraTransitBox(newBox, duration, easing) {
    if (duration === void 0) {
      duration = 0;
    }

    if (newBox) {
      if (duration === 0) {
        this.boxHelper.defaultBox = newBox;
      } else {
        this.boxHelper.transitToBox(newBox, duration, easing);
      }
    }
  },
  onCameraBoxAdd: function onCameraBoxAdd(type, box) {
    if (box instanceof cc.Node) {
      this._boxes[type] = box;
    }
  },
  onCameraBoxSwitch: function onCameraBoxSwitch(type, duration, easing) {
    var newBox = this._boxes[type];
    this.onCameraTransitBox(newBox, duration, easing);
  },
  onCameraStartShake: function onCameraStartShake() {
    this._isShaking = true;
  },
  onCameraStopShake: function onCameraStopShake() {
    this._isShaking = false;
    this._currentShakeOffset = cc.v2();
    this._shakingTime = 0;
  } //#endregion

});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9zY3JpcHRzL1BsdWdpbnMvQ2FtZXJhL0NhbWVyYUNvbnRyb2xsZXIyRC5qcyJdLCJuYW1lcyI6WyJTdGlja01vZGVzIiwiY2MiLCJFbnVtIiwiTm9uZSIsIlRvcCIsIkJvdHRvbSIsIlJpZ2h0IiwiTGVmdCIsIkNhcHR1cmVCb3hIZWxwZXIiLCJDbGFzcyIsIm5hbWUiLCJwcm9wZXJ0aWVzIiwic3RpY2tNb2RlIiwidHlwZSIsInRvb2x0aXAiLCJkZWZhdWx0Qm94IiwiTm9kZSIsImdldCIsIl9pc1RyYW5zaXRpb24iLCJfdHJhbnNpdGlvbkJveCIsIl9kZWZhdWx0Qm94Iiwic2V0IiwiYm94Iiwic2VyaWFsaXphYmxlIiwiX3RyYW5zaXRUd2VlbiIsInBnIiwiVHdlZW4iLCJfdHJhbnNpdFZhbHVlIiwiX3RyYW5zaXRpb25SZXNpemUiLCJSZXNpemVDb21wb25lbnQiLCJ0cmFuc2l0VG9Cb3giLCJuZXdCb3giLCJkdXJhdGlvbiIsImVhc2luZyIsImNhbmNlbFRyYW5zaXRpb24iLCJ0d2Vlbk1hbmFnZXIiLCJhZGQiLCJfc2V0VHJhbnNpdEJveCIsImRlZmF1bHRCb3hSZXNpemUiLCJnZXRDb21wb25lbnQiLCJuZXdCb3hSZXNpemUiLCJpbml0aWFsUG9zIiwicG9zaXRpb24iLCJjbG9uZSIsIm9uVXBkYXRlIiwieCIsInkiLCJ3aWR0aCIsImhlaWdodCIsIm9uQ29tcGxldGUiLCJzdG9wIiwiYWRkQ29tcG9uZW50Iiwic2V0UGFyZW50IiwicGFyZW50IiwiQ29tcG9uZW50IiwiZm9jdXMiLCJ2MiIsImlzVXNpbmdDYW1lcmFCb3hlcyIsImJveEhlbHBlciIsInZpc2libGUiLCJmaXRTcGFjZSIsImRlbHRhU2hha2UiLCJWZWMyIiwiWkVSTyIsInNoYWtlRnJlcXVlbmN5IiwiX2NhbWVyYSIsIl9ib3hlcyIsIl9jdXJyZW50U2hha2VPZmZzZXQiLCJfaXNTaGFraW5nIiwiX3NoYWtpbmdUaW1lIiwiX3N0YXRpY0NhbWVyYVBvcyIsImVkaXRvciIsIm1lbnUiLCJvbkxvYWQiLCJub2RlIiwiQ2FtZXJhIiwiX2hhbmRsZVN1YnNjcmlwdGlvbiIsIm9uRW5hYmxlIiwidXBkYXRlIiwiZHQiLCJfdXBkYXRlUG9zaXRpb24iLCJfdXBkYXRlWm9vbVJhdGlvIiwieE9mZnNldCIsIk1hdGgiLCJzaW4iLCJQSSIsInlPZmZzZXQiLCJpc09uIiwiZnVuYyIsInN5c3RlbUV2ZW50IiwiR2FtZUV2ZW50IiwiQ0FNRVJBX1RSQU5TSVRfQk9YIiwib25DYW1lcmFUcmFuc2l0Qm94IiwiQ0FNRVJBX0JPWF9BREQiLCJvbkNhbWVyYUJveEFkZCIsIkNBTUVSQV9CT1hfU1dJVENIIiwib25DYW1lcmFCb3hTd2l0Y2giLCJDQU1FUkFfU1RBUlRfU0hBS0UiLCJvbkNhbWVyYVN0YXJ0U2hha2UiLCJDQU1FUkFfU1RPUF9TSEFLRSIsIm9uQ2FtZXJhU3RvcFNoYWtlIiwiem9vbVJhdGlvIiwidHciLCJ0aCIsImd3Iiwic2V0dGluZ3MiLCJHQU1FX1dJRFRIIiwiZ2giLCJHQU1FX0hFSUdIVCIsInpYIiwielkiLCJtYXgiLCJtaW4iLCJfc2V0Wm9vbVJhdGlvIiwidGFyZ2V0V29ybGRQb3NpdGlvbiIsImNvbnZlcnRUb1dvcmxkU3BhY2VBUiIsIm9mZnNldCIsImFuY2hvclgiLCJhbmNob3JZIiwiY2FtZXJhV29ybGRQb3NpdGlvbiIsIl9jaGVja1N0aWNrUG9zaXRpb24iLCJjYW1lcmFMb2NhbFBvc2l0aW9uIiwiY29udmVydFRvTm9kZVNwYWNlQVIiLCJzZXRQb3NpdGlvbiIsImNhbWVyYVdvcmxkIiwidmlld1NpemUiLCJ2aWV3IiwiZ2V0VmlzaWJsZVNpemUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBRUE7Ozs7QUFGQTtBQUlBO0FBRUEsSUFBTUEsVUFBVSxHQUFHQyxFQUFFLENBQUNDLElBQUgsQ0FBUTtFQUN2QkMsSUFBSSxFQUFFLENBRGlCO0VBRXZCQyxHQUFHLEVBQUUsQ0FGa0I7RUFHdkJDLE1BQU0sRUFBRSxDQUhlO0VBSXZCQyxLQUFL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O0lBQ2hCLEtBQUtoQyxVQUFMLEdBQWtCLEtBQWxCO0lBQ0EsS0FBS0QsbUJBQUwsR0FBMkJsRSxFQUFFLENBQUN1RCxFQUFILEVBQTNCO0lBQ0EsS0FBS2EsWUFBTCxHQUFvQixDQUFwQjtFQUNILENBbk5JLENBcU5MOztBQXJOSyxDQUFUIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyIvLyNyZWdpb24gaW1wb3J0XG5cbmltcG9ydCBHYW1lRXZlbnQgZnJvbSAnR2FtZUV2ZW50JztcblxuLy8jZW5kcmVnaW9uXG5cbmNvbnN0IFN0aWNrTW9kZXMgPSBjYy5FbnVtKHtcbiAgICBOb25lOiAwLFxuICAgIFRvcDogMSxcbiAgICBCb3R0b206IDIsXG4gICAgUmlnaHQ6IDMsXG4gICAgTGVmdDogNCxcbn0pO1xuXG5jb25zdCBDYXB0dXJlQm94SGVscGVyID0gY2MuQ2xhc3Moe1xuICAgIG5hbWU6ICdDYXB0dXJlQm94SGVscGVyJyxcbiAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgIC8vI3JlZ2lvbiBlZGl0b3JzIGZpZWxkcyBhbmQgcHJvcGVydGllc1xuXG4gICAgICAgIHN0aWNrTW9kZToge1xuICAgICAgICAgICAgZGVmYXVsdDogU3RpY2tNb2Rlcy5Cb3R0b20sXG4gICAgICAgICAgICB0eXBlOiBTdGlja01vZGVzLFxuICAgICAgICAgICAgdG9vbHRpcDogJ9C6INC60LDQutC+0Lkg0YHRgtC+0YDQvtC90LUg0Y3QutGA0LDQvdCwINC/0YDQuNC70LjQv9Cw0LXRgiDQuNC30L7QsdGA0LDQttC10L3QuNC1JyxcbiAgICAgICAgfSxcbiAgICAgICAgZGVmYXVsdEJveDoge1xuICAgICAgICAgICAgdHlwZTogY2MuTm9kZSxcbiAgICAgICAgICAgIGdldCgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5faXNUcmFuc2l0aW9uICYmIHRoaXMuX3RyYW5zaXRpb25Cb3ggPyB0aGlzLl90cmFuc2l0aW9uQm94IDogdGhpcy5fZGVmYXVsdEJveDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZXQoYm94KSB7XG4gICAgICAgICAgICAgICAgaWYgKGJveCBpbnN0YW5jZW9mIGNjLk5vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZGVmYXVsdEJveCA9IGJveDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdG9vbHRpcDogJ9C90LDRh9Cw0LvRjNC90LDRjyDQutC+0YDQvtCx0LrQsCwg0L3QsCDQutC+0YLQvtGA0YPRjiDRgdC80L7RgtGA0LjRgiDQutCw0LzQtdGA0LAnLFxuICAgICAgICB9LFxuXG4gICAgICAgIC8vI2VuZHJlZ2lvblxuXG4gICAgICAgIC8vI3JlZ2lvbiBwcml2YXRlIGZpZWxkIGFuZCBwcm9wZXJ0aWVzXG5cbiAgICAgICAgX2RlZmF1bHRCb3g6IHsgZGVmYXVsdDogbnVsbCwgdHlwZTogY2MuTm9kZSB9LFxuXG4gICAgICAgIF9pc1RyYW5zaXRpb246IHsgZGVmYXVsdDogZmFsc2UsIHNlcmlhbGl6YWJsZTogZmFsc2UgfSxcbiAgICAgICAgX3RyYW5zaXRUd2VlbjogeyBkZWZhdWx0OiBudWxsLCB0eXBlOiBwZy5Ud2Vlbiwgc2VyaWFsaXphYmxlOiBmYWxzZSB9LFxuICAgICAgICBfdHJhbnNpdFZhbHVlOiB7IGRlZmF1bHQ6IDAsIHNlcmlhbGl6YWJsZTogZmFsc2UgfSxcblxuICAgICAgICBfdHJhbnNpdGlvbkJveDogeyBkZWZhdWx0OiBudWxsLCB0eXBlOiBjYy5Ob2RlLCBzZXJpYWxpemFibGU6IGZhbHNlIH0sXG4gICAgICAgIF90cmFuc2l0aW9uUmVzaXplOiB7IGRlZmF1bHQ6IG51bGwsIHR5cGU6IHBnLlJlc2l6ZUNvbXBvbmVudCwgc2VyaWFsaXphYmxlOiBmYWxzZSB9LFxuXG4gICAgICAgIC8vI2VuZHJlZ2lvblxuICAgIH0sXG5cbiAgICB0cmFuc2l0VG9Cb3gobmV3Qm94LCBkdXJhdGlvbiwgZWFzaW5nKSB7XG4gICAgICAgIHRoaXMuX2lzVHJhbnNpdGlvbiAmJiB0aGlzLmNhbmNlbFRyYW5zaXRpb24oKTtcbiAgICAgICAgdGhpcy5fdHJhbnNpdFZhbHVlID0gMDtcblxuICAgICAgICB0aGlzLl90cmFuc2l0VHdlZW4gPSBwZy50d2Vlbk1hbmFnZXIuYWRkKHRoaXMsIHsgX3RyYW5zaXRWYWx1ZTogMSB9LCBkdXJhdGlvbiwgZWFzaW5nKTtcbiAgICAgICAgdGhpcy5fc2V0VHJhbnNpdEJveChuZXdCb3gpO1xuXG4gICAgICAgIGNvbnN0IGRlZmF1bHRCb3hSZXNpemUgPSB0aGlzLmRlZmF1bHRCb3guZ2V0Q29tcG9uZW50KHBnLlJlc2l6ZUNvbXBvbmVudCk7XG4gICAgICAgIGNvbnN0IG5ld0JveFJlc2l6ZSA9IG5ld0JveC5nZXRDb21wb25lbnQocGcuUmVzaXplQ29tcG9uZW50KTtcblxuICAgICAgICBpZiAoZGVmYXVsdEJveFJlc2l6ZSAmJiBuZXdCb3hSZXNpemUpIHtcbiAgICAgICAgICAgIHRoaXMuX3RyYW5zaXRpb25SZXNpemUuc2V0KGRlZmF1bHRCb3hSZXNpemUpO1xuXG4gICAgICAgICAgICBjb25zdCBpbml0aWFsUG9zID0gdGhpcy5kZWZhdWx0Qm94LnBvc2l0aW9uLmNsb25lKCk7XG5cbiAgICAgICAgICAgIHRoaXMuX3RyYW5zaXRUd2Vlbi5vblVwZGF0ZSA9ICgpID0+IHtcbiAgICAgICAgICAgICAgICAvLyBGSVhNRTogbGVycCByZXNpemUgd2l0aCBhYnNvbHV0ZSBwb3NpdGlvblxuICAgICAgICAgICAgICAgIC8vZGVmYXVsdEJveFJlc2l6ZS5sZXJwKG5ld0JveFJlc2l6ZSwgdGhpcy5fdHJhbnNpdFZhbHVlLCB0aGlzLl90cmFuc2l0aW9uUmVzaXplKTtcblxuICAgICAgICAgICAgICAgIHRoaXMuX3RyYW5zaXRpb25Cb3gueCA9IG5ld0JveC54ICogdGhpcy5fdHJhbnNpdFZhbHVlICsgKDEgLSB0aGlzLl90cmFuc2l0VmFsdWUpICogdGhpcy5fZGVmYXVsdEJveC54O1xuICAgICAgICAgICAgICAgIHRoaXMuX3RyYW5zaXRpb25Cb3gueSA9IG5ld0JveC55ICogdGhpcy5fdHJhbnNpdFZhbHVlICsgKDEgLSB0aGlzLl90cmFuc2l0VmFsdWUpICogdGhpcy5fZGVmYXVsdEJveC55O1xuICAgICAgICAgICAgICAgIHRoaXMuX3RyYW5zaXRpb25Cb3gud2lkdGggPSBuZXdCb3gud2lkdGggKiB0aGlzLl90cmFuc2l0VmFsdWUgKyAoMSAtIHRoaXMuX3RyYW5zaXRWYWx1ZSkgKiB0aGlzLl9kZWZhdWx0Qm94LndpZHRoO1xuICAgICAgICAgICAgICAgIHRoaXMuX3RyYW5zaXRpb25Cb3guaGVpZ2h0ID0gbmV3Qm94LmhlaWdodCAqIHRoaXMuX3RyYW5zaXRWYWx1ZSArICgxIC0gdGhpcy5fdHJhbnNpdFZhbHVlKSAqIHRoaXMuX2RlZmF1bHRCb3guaGVpZ2h0O1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdGhpcy5fdHJhbnNpdFR3ZWVuLm9uQ29tcGxldGUgPSAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5faXNUcmFuc2l0aW9uID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdGhpcy5kZWZhdWx0Qm94ID0gbmV3Qm94O1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdGhpcy5faXNUcmFuc2l0aW9uID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBjYW5jZWxUcmFuc2l0aW9uKCkge1xuICAgICAgICB0aGlzLl90cmFuc2l0VHdlZW4gJiYgdGhpcy5fdHJhbnNpdFR3ZWVuLnN0b3AoKTtcbiAgICAgICAgdGhpcy5fdHJhbnNpdFZhbHVlID0gMDtcbiAgICAgICAgdGhpcy5faXNUcmFuc2l0aW9uID0gZmFsc2U7XG5cbiAgICAgICAgdGhpcy5kZWZhdWx0Qm94ID0gdGhpcy5fdHJhbnNpdGlvbkJveDtcbiAgICB9LFxuXG4gICAgX3NldFRyYW5zaXRCb3gobmV3Qm94KSB7XG4gICAgICAgIGlmICghdGhpcy5fdHJhbnNpdGlvbkJveCkge1xuICAgICAgICAgICAgdGhpcy5fdHJhbnNpdGlvbkJveCA9IG5ldyBjYy5Ob2RlKCdDYW1lcmFUcmFuc2l0aW9uQm94Jyk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIXRoaXMuX3RyYW5zaXRpb25SZXNpemUpIHtcbiAgICAgICAgICAgIHRoaXMuX3RyYW5zaXRpb25SZXNpemUgPVxuICAgICAgICAgICAgICAgIHRoaXMuX3RyYW5zaXRpb25Cb3guZ2V0Q29tcG9uZW50KHBnLlJlc2l6ZUNvbXBvbmVudCkgfHwgdGhpcy5fdHJhbnNpdGlvbkJveC5hZGRDb21wb25lbnQocGcuUmVzaXplQ29tcG9uZW50KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuX3RyYW5zaXRpb25Cb3guc2V0UGFyZW50KG5ld0JveC5wYXJlbnQpO1xuICAgIH0sXG59KTtcblxuY2MuQ2xhc3Moe1xuICAgIGV4dGVuZHM6IGNjLkNvbXBvbmVudCxcblxuICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgLy8jcmVnaW9uIGVkaXRvcnMgZmllbGRzIGFuZCBwcm9wZXJ0aWVzXG5cbiAgICAgICAgZm9jdXM6IHtcbiAgICAgICAgICAgIGRlZmF1bHQ6IGNjLnYyKDAuNSwgMC41KSxcbiAgICAgICAgICAgIHRvb2x0aXA6ICfRhNC+0LrRg9GBINC60LDQvNC10YDRiyDQvtGCIDAg0LTQviAxINC/0L4g0LrQsNC20LTQvtC5INC40Lcg0L7RgdC10LknLFxuICAgICAgICB9LFxuXG4gICAgICAgIGlzVXNpbmdDYW1lcmFCb3hlczoge1xuICAgICAgICAgICAgZGVmYXVsdDogZmFsc2UsXG4gICAgICAgICAgICB0b29sdGlwOiAn0LjRgdC/0L7Qu9GM0LfQvtCy0LDRgtGMINC60LDQvNC10YDQsCDQsdC+0LrRgdGLLiDQldGB0LvQuCDQvdC10YIsINC/0YDQtdC00L/QvtC70LDQs9Cw0LXRgtGB0Y8g0YfRgtC+INC60LDQvNC10YDQsCDRgdGC0LDRgtC40YfQvdCwJyxcbiAgICAgICAgfSxcblxuICAgICAgICAvLyNlbmRyZWdpb25cblxuICAgICAgICAvLyNyZWdpb24gZWRpdG9ycyBmaWVsZHMgYW5kIHByb3BlcnRpZXNcblxuICAgICAgICBib3hIZWxwZXI6IHtcbiAgICAgICAgICAgIGRlZmF1bHQoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBDYXB0dXJlQm94SGVscGVyKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdmlzaWJsZSgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5pc1VzaW5nQ2FtZXJhQm94ZXM7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdHlwZTogQ2FwdHVyZUJveEhlbHBlcixcbiAgICAgICAgfSxcblxuICAgICAgICBmaXRTcGFjZToge1xuICAgICAgICAgICAgZGVmYXVsdDogZmFsc2UsXG4gICAgICAgICAgICB2aXNpYmxlKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmlzVXNpbmdDYW1lcmFCb3hlcztcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB0b29sdGlwOlxuICAgICAgICAgICAgICAgICfQtdGB0LvQuCB0cnVlLCDQutCw0LzQtdGA0LAg0LPQsNGA0LDQvdGC0LjRgNGD0LXRgiDQv9C+0L/QsNC00LDQvdC40LUg0LLRgdC10Lkg0LrQvtGA0L7QsdC60LgsINC90LAgZmFsc2Ug0LPQsNGA0LDQvdGC0LjRgNGD0LXRgtGB0Y8g0L/QvtC60YDRi9GC0LjQtSDQutCw0LzQtdGA0Ysg0YbQtdC70LjQutC+0LwgKNCx0LXQtyDRh9C10YDQvdGL0YUg0L/QvtC70L7RgSknLFxuICAgICAgICB9LFxuXG4gICAgICAgIGRlbHRhU2hha2U6IHtcbiAgICAgICAgICAgIGRlZmF1bHQ6IGNjLlZlYzIuWkVSTyxcbiAgICAgICAgICAgIHRvb2x0aXA6ICfQstC10LrRgtC+0YAg0LTQu9GPINGI0LXQudC60LAg0LrQsNC80LXRgNGLLiDQl9Cw0LTQsNC10YIg0L3QsNC/0YDQsNCy0LvQtdC90LjQtSDQuCDQsNC80L/Qu9C40YLRg9C00YMnLFxuICAgICAgICB9LFxuXG4gICAgICAgIHNoYWtlRnJlcXVlbmN5OiB7XG4gICAgICAgICAgICBkZWZhdWx0OiBjYy52MigxLCAxKSxcbiAgICAgICAgICAgIHRvb2x0aXA6ICfQutC+0LvQuNGH0LXRgdGC0LLQviDQv9C+0LvQvdGL0YUg0L7QsdC+0YDQvtGC0L7QsiDQutCw0LzQtdGA0Ysg0L/QviDQutCw0LbQtNC+0Lkg0L7RgdC4INC30LAg0YHQtdC60YPQvdC00YMnLFxuICAgICAgICB9LFxuXG4gICAgICAgIC8vI2VuZHJlZ2lvblxuXG4gICAgICAgIC8vI3JlZ2lvbiBwcml2YXRlIGZpZWxkIGFuZCBwcm9wZXJ0aWVzXG5cbiAgICAgICAgX2NhbWVyYTogeyBkZWZhdWx0OiBudWxsLCBzZXJpYWxpemFibGU6IGZhbHNlIH0sXG4gICAgICAgIF9ib3hlczogeyBkZWZhdWx0OiB7fSwgc2VyaWFsaXphYmxlOiBmYWxzZSB9LFxuICAgICAgICBfY3VycmVudFNoYWtlT2Zmc2V0OiB7IGRlZmF1bHQ6IGNjLnYyKCksIHNlcmlhbGl6YWJsZTogZmFsc2UgfSxcbiAgICAgICAgX2lzU2hha2luZzogeyBkZWZhdWx0OiBmYWxzZSwgc2VyaWFsaXphYmxlOiBmYWxzZSB9LFxuICAgICAgICBfc2hha2luZ1RpbWU6IHsgZGVmYXVsdDogMCwgc2VyaWFsaXphYmxlOiBmYWxzZSB9LFxuICAgICAgICBfc3RhdGljQ2FtZXJhUG9zOiB7IGRlZmF1bHQ6IGNjLnYyKCksIHNlcmlhbGl6YWJsZTogZmFsc2UgfSxcblxuICAgICAgICAvLyNlbmRyZWdpb25cbiAgICB9LFxuXG4gICAgZWRpdG9yOiB7XG4gICAgICAgIG1lbnU6ICdDYW1lcmEvQ2FtZXJhQ29udHJvbGxlcjJEJyxcbiAgICB9LFxuXG4gICAgLy8jcmVnaW9uIGxpZmUtY3ljbGUgY2FsbGJhY2tzXG5cbiAgICBvbkxvYWQoKSB7XG4gICAgICAgIGlmICghdGhpcy5fY2FtZXJhKSB7XG4gICAgICAgICAgICB0aGlzLl9jYW1lcmEgPSB0aGlzLm5vZGUuZ2V0Q29tcG9uZW50KGNjLkNhbWVyYSk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLl9oYW5kbGVTdWJzY3JpcHRpb24odHJ1ZSk7XG4gICAgfSxcblxuICAgIG9uRW5hYmxlKCkge1xuICAgICAgICB0aGlzLl9zdGF0aWNDYW1lcmFQb3MgPSB0aGlzLm5vZGUucG9zaXRpb24uY2xvbmUoKTtcbiAgICB9LFxuXG4gICAgdXBkYXRlKGR0KSB7XG4gICAgICAgIHRoaXMuX3VwZGF0ZVBvc2l0aW9uKCk7XG4gICAgICAgIHRoaXMuX3VwZGF0ZVpvb21SYXRpbygpO1xuXG4gICAgICAgIGlmICh0aGlzLl9pc1NoYWtpbmcpIHtcblxuICAgICAgICAgICAgdGhpcy5fc2hha2luZ1RpbWUgKz0gZHQ7XG5cbiAgICAgICAgICAgIC8vINC60LDQvNC10YDQsCDRgtGA0Y/RgdC10YLRgdGPINC/0L4g0YHQuNC90YPRgdC+0LjQtNC1INGBINC30LDQtNCw0L3QvdC+0Lkg0YfQsNGB0YLQvtGC0L7QuSDQuCDQsNC80L/Qu9C40YLRg9C00L7QuVxuICAgICAgICAgICAgY29uc3QgeE9mZnNldCA9XG4gICAgICAgICAgICAgICAgdGhpcy5zaGFrZUZyZXF1ZW5jeS54ID4gMCA/IE1hdGguc2luKE1hdGguUEkgKiB0aGlzLl9zaGFraW5nVGltZSAqIHRoaXMuc2hha2VGcmVxdWVuY3kueCkgKiB0aGlzLmRlbHRhU2hha2UueCA6IDA7XG4gICAgICAgICAgICBjb25zdCB5T2Zmc2V0ID1cbiAgICAgICAgICAgICAgICB0aGlzLnNoYWtlRnJlcXVlbmN5LnkgPiAwID8gTWF0aC5zaW4oTWF0aC5QSSAqIHRoaXMuX3NoYWtpbmdUaW1lICogdGhpcy5zaGFrZUZyZXF1ZW5jeS55KSAqIHRoaXMuZGVsdGFTaGFrZS55IDogMDtcblxuICAgICAgICAgICAgdGhpcy5fY3VycmVudFNoYWtlT2Zmc2V0ID0gY2MudjIoeE9mZnNldCwgeU9mZnNldCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgLy8jZW5kcmVnaW9uXG5cbiAgICAvLyNyZWdpb24gcHVibGljIG1ldGhvZHNcbiAgICAvLyNlbmRyZWdpb25cblxuICAgIC8vI3JlZ2lvbiBwcml2YXRlIG1ldGhvZFxuICAgIF9oYW5kbGVTdWJzY3JpcHRpb24oaXNPbikge1xuICAgICAgICBjb25zdCBmdW5jID0gaXNPbiA/ICdvbicgOiAnb2ZmJztcblxuICAgICAgICBjYy5zeXN0ZW1FdmVudFtmdW5jXShHYW1lRXZlbnQuQ0FNRVJBX1RSQU5TSVRfQk9YLCB0aGlzLm9uQ2FtZXJhVHJhbnNpdEJveCwgdGhpcyk7XG4gICAgICAgIGNjLnN5c3RlbUV2ZW50W2Z1bmNdKEdhbWVFdmVudC5DQU1FUkFfQk9YX0FERCwgdGhpcy5vbkNhbWVyYUJveEFkZCwgdGhpcyk7XG4gICAgICAgIGNjLnN5c3RlbUV2ZW50W2Z1bmNdKEdhbWVFdmVudC5DQU1FUkFfQk9YX1NXSVRDSCwgdGhpcy5vbkNhbWVyYUJveFN3aXRjaCwgdGhpcyk7XG4gICAgICAgIGNjLnN5c3RlbUV2ZW50W2Z1bmNdKEdhbWVFdmVudC5DQU1FUkFfU1RBUlRfU0hBS0UsIHRoaXMub25DYW1lcmFTdGFydFNoYWtlLCB0aGlzKTtcbiAgICAgICAgY2Muc3lzdGVtRXZlbnRbZnVuY10oR2FtZUV2ZW50LkNBTUVSQV9TVE9QX1NIQUtFLCB0aGlzLm9uQ2FtZXJhU3RvcFNoYWtlLCB0aGlzKTtcbiAgICB9LFxuXG4gICAgX3VwZGF0ZVpvb21SYXRpbygpIHtcbiAgICAgICAgbGV0IHpvb21SYXRpbyA9IDE7XG5cbiAgICAgICAgaWYgKHRoaXMuYm94SGVscGVyLmRlZmF1bHRCb3gpIHtcbiAgICAgICAgICAgIGNvbnN0IHR3ID0gdGhpcy5ib3hIZWxwZXIuZGVmYXVsdEJveC53aWR0aDtcbiAgICAgICAgICAgIGNvbnN0IHRoID0gdGhpcy5ib3hIZWxwZXIuZGVmYXVsdEJveC5oZWlnaHQ7XG4gICAgICAgICAgICBjb25zdCBndyA9IHBnLnNldHRpbmdzLkdBTUVfV0lEVEg7XG4gICAgICAgICAgICBjb25zdCBnaCA9IHBnLnNldHRpbmdzLkdBTUVfSEVJR0hUO1xuICAgICAgICAgICAgY29uc3QgelggPSBndyAvIHR3O1xuICAgICAgICAgICAgY29uc3QgelkgPSBnaCAvIHRoO1xuXG4gICAgICAgICAgICB6b29tUmF0aW8gPSB0aGlzLmZpdFNwYWNlID8gTWF0aC5tYXgoelgsIHpZKSA6IE1hdGgubWluKHpYLCB6WSk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLl9zZXRab29tUmF0aW8oem9vbVJhdGlvKTtcbiAgICB9LFxuXG4gICAgX3VwZGF0ZVBvc2l0aW9uKCkge1xuICAgICAgICBpZiAodGhpcy5pc1VzaW5nQ2FtZXJhQm94ZXMgJiYgdGhpcy5ib3hIZWxwZXIuZGVmYXVsdEJveCkge1xuICAgICAgICAgICAgY29uc3QgdGFyZ2V0V29ybGRQb3NpdGlvbiA9IHRoaXMuYm94SGVscGVyLmRlZmF1bHRCb3guY29udmVydFRvV29ybGRTcGFjZUFSKGNjLlZlYzIuWkVSTyk7XG4gICAgICAgICAgICBjb25zdCBvZmZzZXQgPSBjYy52MihcbiAgICAgICAgICAgICAgICB0aGlzLl9jYW1lcmEud2lkdGggKiAodGhpcy5ib3hIZWxwZXIuZGVmYXVsdEJveC5hbmNob3JYIC0gdGhpcy5mb2N1cy54KSxcbiAgICAgICAgICAgICAgICB0aGlzLl9jYW1lcmEuaGVpZ2h0ICogKHRoaXMuYm94SGVscGVyLmRlZmF1bHRCb3guYW5jaG9yWSAtIHRoaXMuZm9jdXMueSlcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBjb25zdCBjYW1lcmFXb3JsZFBvc2l0aW9uID0gdGFyZ2V0V29ybGRQb3NpdGlvbi5hZGQob2Zmc2V0KTtcblxuICAgICAgICAgICAgdGhpcy5fY2hlY2tTdGlja1Bvc2l0aW9uKGNhbWVyYVdvcmxkUG9zaXRpb24pO1xuICAgICAgICAgICAgY29uc3QgY2FtZXJhTG9jYWxQb3NpdGlvbiA9IHRoaXMubm9kZS5wYXJlbnQuY29udmVydFRvTm9kZVNwYWNlQVIoY2FtZXJhV29ybGRQb3NpdGlvbik7XG4gICAgICAgICAgICB0aGlzLm5vZGUuc2V0UG9zaXRpb24oY2FtZXJhTG9jYWxQb3NpdGlvbi5hZGQodGhpcy5fY3VycmVudFNoYWtlT2Zmc2V0KSk7XG4gICAgICAgIH0gZWxzZSBpZiAoIXRoaXMuaXNVc2luZ0NhbWVyYUJveGVzKSB7XG4gICAgICAgICAgICB0aGlzLm5vZGUuc2V0UG9zaXRpb24odGhpcy5fc3RhdGljQ2FtZXJhUG9zLmFkZCh0aGlzLl9jdXJyZW50U2hha2VPZmZzZXQpKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBfY2hlY2tTdGlja1Bvc2l0aW9uKGNhbWVyYVdvcmxkKSB7XG4gICAgICAgIGNvbnN0IHZpZXdTaXplID0gY2Mudmlldy5nZXRWaXNpYmxlU2l6ZSgpO1xuXG4gICAgICAgIHN3aXRjaCAodGhpcy5ib3hIZWxwZXIuc3RpY2tNb2RlKSB7XG4gICAgICAgICAgICBjYXNlIFN0aWNrTW9kZXMuVG9wOlxuICAgICAgICAgICAgICAgIGNhbWVyYVdvcmxkLnkgPSBjYW1lcmFXb3JsZC55IC0gKHRoaXMuX2NhbWVyYS5oZWlnaHQgLSB0aGlzLmJveEhlbHBlci5kZWZhdWx0Qm94LmhlaWdodCkgKiAwLjU7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgU3RpY2tNb2Rlcy5Cb3R0b206XG4gICAgICAgICAgICAgICAgY2FtZXJhV29ybGQueSA9IGNhbWVyYVdvcmxkLnkgKyAodGhpcy5fY2FtZXJhLmhlaWdodCAtIHRoaXMuYm94SGVscGVyLmRlZmF1bHRCb3guaGVpZ2h0KSAqIDAuNTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSBTdGlja01vZGVzLlJpZ2h0OlxuICAgICAgICAgICAgICAgIGNhbWVyYVdvcmxkLnggPSBjYW1lcmFXb3JsZC54IC0gKHRoaXMuX2NhbWVyYS53aWR0aCAtIHRoaXMuYm94SGVscGVyLmRlZmF1bHRCb3gud2lkdGgpICogMC41O1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlIFN0aWNrTW9kZXMuTGVmdDpcbiAgICAgICAgICAgICAgICBjYW1lcmFXb3JsZC54ID0gY2FtZXJhV29ybGQueCArICh0aGlzLl9jYW1lcmEud2lkdGggLSB0aGlzLmJveEhlbHBlci5kZWZhdWx0Qm94LndpZHRoKSAqIDAuNTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBfc2V0Wm9vbVJhdGlvKHpvb21SYXRpbykge1xuICAgICAgICB0aGlzLl9jYW1lcmEuem9vbVJhdGlvID0gem9vbVJhdGlvO1xuICAgICAgICB0aGlzLl9jYW1lcmEud2lkdGggPSBwZy5zZXR0aW5ncy5HQU1FX1dJRFRIIC8gdGhpcy5fY2FtZXJhLnpvb21SYXRpbztcbiAgICAgICAgdGhpcy5fY2FtZXJhLmhlaWdodCA9IHBnLnNldHRpbmdzLkdBTUVfSEVJR0hUIC8gdGhpcy5fY2FtZXJhLnpvb21SYXRpbztcbiAgICB9LFxuXG4gICAgLy8jZW5kcmVnaW9uXG5cbiAgICAvLyNyZWdpb24gZXZlbnQgaGFuZGxlcnNcblxuICAgIG9uQ2FtZXJhVHJhbnNpdEJveChuZXdCb3gsIGR1cmF0aW9uID0gMCwgZWFzaW5nKSB7XG4gICAgICAgIGlmIChuZXdCb3gpIHtcbiAgICAgICAgICAgIGlmIChkdXJhdGlvbiA9PT0gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMuYm94SGVscGVyLmRlZmF1bHRCb3ggPSBuZXdCb3g7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuYm94SGVscGVyLnRyYW5zaXRUb0JveChuZXdCb3gsIGR1cmF0aW9uLCBlYXNpbmcpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIG9uQ2FtZXJhQm94QWRkKHR5cGUsIGJveCkge1xuICAgICAgICBpZiAoYm94IGluc3RhbmNlb2YgY2MuTm9kZSkge1xuICAgICAgICAgICAgdGhpcy5fYm94ZXNbdHlwZV0gPSBib3g7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgb25DYW1lcmFCb3hTd2l0Y2godHlwZSwgZHVyYXRpb24sIGVhc2luZykge1xuICAgICAgICBjb25zdCBuZXdCb3ggPSB0aGlzLl9ib3hlc1t0eXBlXTtcblxuICAgICAgICB0aGlzLm9uQ2FtZXJhVHJhbnNpdEJveChuZXdCb3gsIGR1cmF0aW9uLCBlYXNpbmcpO1xuICAgIH0sXG5cbiAgICBvbkNhbWVyYVN0YXJ0U2hha2UoKSB7XG4gICAgICAgIHRoaXMuX2lzU2hha2luZyA9IHRydWU7XG4gICAgfSxcblxuICAgIG9uQ2FtZXJhU3RvcFNoYWtlKCkge1xuICAgICAgICB0aGlzLl9pc1NoYWtpbmcgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5fY3VycmVudFNoYWtlT2Zmc2V0ID0gY2MudjIoKTtcbiAgICAgICAgdGhpcy5fc2hha2luZ1RpbWUgPSAwO1xuICAgIH0sXG5cbiAgICAvLyNlbmRyZWdpb25cbn0pO1xuIl19